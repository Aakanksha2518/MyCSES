name: 🏷️ Issue Labeler

on:
  issues:
    types: [opened, edited]

jobs:
  label:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read

    steps:
      - name: Label based on content
        uses: actions/github-script@v7
        with:
          script: |
            // Support only issues
            const item = context.payload.issue;
            if (!item) {
              console.log('No issue payload found. Exiting.');
              return;
            }
            const issueTitleAndBody = (item.title + ' ' + (item.body || '')).toLowerCase();
            
            // Define label mappings based on existing repository labels
            const labelMappings = [
              // Category labels based on folder structure
              {
                keywords: ['1_introductory', 'introductory', 'basic', 'beginner'],
                label: 'category: introductory'
              },
              {
                keywords: ['2_sorting_searching', 'sorting', 'searching', 'binary search', 'sort'],
                label: 'category: sorting-searching'
              },
              {
                keywords: ['3_dp', 'dynamic programming', 'dp', 'memoization'],
                label: 'category: dp'
              },
              {
                keywords: ['5_range_queries', 'range query', 'segment tree', 'fenwick'],
                label: 'category: range-queries'
              },
              {
                keywords: ['7_mathematics', 'math', 'number theory', 'gcd', 'modular'],
                label: 'category: mathematics'
              },
              {
                keywords: ['graph', 'dfs', 'bfs', 'shortest path', 'tree', 'dijkstra'],
                label: 'category: graph'
              },
              {
                keywords: ['geometry', 'point', 'line', 'polygon', 'convex hull'],
                label: 'category: geometry'
              },
              {
                keywords: ['string', 'substring', 'pattern', 'kmp', 'suffix'],
                label: 'category: string'
              },
              {
                keywords: ['tree', 'binary tree', 'ancestor', 'lca'],
                label: 'category: tree'
              },
              {
                keywords: ['advanced', 'complex', 'hard technique'],
                label: 'category: advanced'
              },
              
              // Difficulty labels
              {
                keywords: ['easy', 'simple', 'basic', 'beginner'],
                label: 'easy'
              },
              {
                keywords: ['medium', 'intermediate'],
                label: 'medium'
              },
              
              // Issue type labels
              {
                keywords: ['bug', 'error', 'wrong', 'incorrect', 'fix', 'broken'],
                label: 'bug'
              },
              {
                keywords: ['feature', 'enhancement', 'new', 'add', 'implement'],
                label: 'enhancement'
              },
              {
                keywords: ['documentation', 'readme', 'comment', 'explain'],
                label: 'documentation'
              },
              {
                keywords: ['duplicate', 'already exists', 'same as'],
                label: 'duplicate'
              },
              {
                keywords: ['help wanted', 'help needed', 'assistance'],
                label: 'help wanted'
              },
              {
                keywords: ['good first issue', 'beginner friendly', 'newcomer'],
                label: 'good first issue'
              },
              
              // Hacktoberfest labels
              {
                keywords: ['hacktoberfest', 'hacktober', 'october', 'hactoberfest'],
                label: 'hacktoberfest'
              },
              {
                keywords: ['hacktoberfest 2025', '2025', 'hactoberfest_2025'],
                label: 'hacktoberfest_2025'
              }
            ];
            
            const labelsToAdd = [];
            
            // Check for keyword matches
            for (const mapping of labelMappings) {
              for (const keyword of mapping.keywords) {
                if (issueTitleAndBody.includes(keyword)) {
                  if (!labelsToAdd.includes(mapping.label)) {
                    labelsToAdd.push(mapping.label);
                  }
                  break;
                }
              }
            }
            
            // Always add Hacktoberfest labels during October (Hacktoberfest month)
            const currentDate = new Date();
            const currentMonth = currentDate.getMonth(); // 0-indexed, so October is 9
            const currentYear = currentDate.getFullYear();
            
            if (currentMonth === 9) { // October
              if (!labelsToAdd.includes('hacktoberfest')) {
                labelsToAdd.push('hacktoberfest');
              }
              if (!labelsToAdd.includes('hacktoberfest_2025') && currentYear === 2025) {
                labelsToAdd.push('hacktoberfest_2025');
              }
            }
            
            // Remove duplicates
            const uniqueLabels = [...new Set(labelsToAdd)];
            
            if (uniqueLabels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: item.number,
                labels: uniqueLabels,
              });
              
              console.log(`Added labels: ${uniqueLabels.join(', ')}`);
            } else {
              console.log('No matching labels found');
            }
