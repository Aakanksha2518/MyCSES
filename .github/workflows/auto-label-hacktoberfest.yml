name: Auto-label Issues and PRs

on:
  issues:
    types: [opened]
  pull_request:
    types: [opened]

permissions:
  issues: write
  pull-requests: write
  contents: read

jobs:
  auto-label:
    runs-on: ubuntu-latest
    
    steps:
    - name: Add Hacktoberfest labels to issues
      if: github.event_name == 'issues'
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          // Get current date to check if we're in October
          const now = new Date();
          const currentMonth = now.getMonth() + 1; // getMonth() returns 0-11
          const currentYear = now.getFullYear();
          
          // Add hacktoberfest label during October or if it's Hacktoberfest season
          const isHacktoberfestSeason = currentMonth === 10;
          
          // Always add hacktoberfest labels since this repo participates year-round
          const labelsToAdd = ['hacktoberfest'];
          
          // Add additional labels based on issue content or during Hacktoberfest season
          if (isHacktoberfestSeason) {
            labelsToAdd.push(`hacktoberfest_${currentYear}`);
          }
          
          // Check issue title and body for keywords to determine difficulty
          const issueTitle = context.payload.issue.title.toLowerCase();
          const issueBody = (context.payload.issue.body || '').toLowerCase();
          const combinedText = issueTitle + ' ' + issueBody;
          
          // Auto-add 'good first issue' for beginner-friendly problems
          const beginnerKeywords = [
            'introductory', 'basic', 'easy', 'beginner', 'simple', 'hello world',
            'missing number', 'weird algorithm', 'repetitions', 'increasing array'
          ];
          
          if (beginnerKeywords.some(keyword => combinedText.includes(keyword))) {
            labelsToAdd.push('good first issue');
          }
          
          // Auto-add 'help wanted' for complex problems
          const complexKeywords = [
            'hard', 'difficult', 'complex', 'advanced', 'optimization needed',
            'graph', 'tree', 'geometry', 'string algorithm'
          ];
          
          if (complexKeywords.some(keyword => combinedText.includes(keyword))) {
            labelsToAdd.push('help wanted');
          }
          
          // Add category-specific labels
          const categoryMap = {
            'introductory': 'category: introductory',
            'sorting': 'category: sorting-searching',
            'searching': 'category: sorting-searching',
            'dynamic programming': 'category: dp',
            'dp': 'category: dp',
            'graph': 'category: graph',
            'tree': 'category: tree',
            'mathematics': 'category: mathematics',
            'math': 'category: mathematics',
            'string': 'category: string',
            'geometry': 'category: geometry'
          };
          
          for (const [keyword, label] of Object.entries(categoryMap)) {
            if (combinedText.includes(keyword)) {
              labelsToAdd.push(label);
              break; // Only add one category label
            }
          }
          
          // Add the labels to the issue
          try {
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              labels: labelsToAdd
            });
            
            console.log(`Added labels: ${labelsToAdd.join(', ')}`);
          } catch (error) {
            console.error('Error adding labels:', error);
          }

    - name: Add thank you message to PR
      if: github.event_name == 'pull_request'
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const message = "Thank you for your contribution! üôè";
          
          try {
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.pull_request.number,
              body: message
            });
            
            console.log('Added thank you message to PR');
          } catch (error) {
            console.error('Error adding thank you message to PR:', error);
          }